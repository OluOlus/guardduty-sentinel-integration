{
  "incidentTemplate": {
    "title": "GuardDuty Security Finding: {{Type}} - {{Title}}",
    "description": "AWS GuardDuty has detected a security finding in account {{AccountId}} ({{Region}})",
    "severity": "{{#if (gte Severity 8.5)}}High{{else if (gte Severity 7.0)}}Medium{{else}}Low{{/if}}",
    "status": "New",
    "classification": {
      "classificationComment": "Automated incident created from AWS GuardDuty finding",
      "classificationReason": "SuspiciousActivity"
    },
    "labels": [
      {
        "labelName": "Source",
        "labelType": "System",
        "labelValue": "AWS GuardDuty"
      },
      {
        "labelName": "Account",
        "labelType": "User", 
        "labelValue": "{{AccountId}}"
      },
      {
        "labelName": "Region",
        "labelType": "User",
        "labelValue": "{{Region}}"
      },
      {
        "labelName": "FindingType",
        "labelType": "User",
        "labelValue": "{{Type}}"
      },
      {
        "labelName": "Severity",
        "labelType": "System",
        "labelValue": "{{Severity}}"
      }
    ],
    "tasks": [
      {
        "title": "Initial Assessment",
        "description": "Review the GuardDuty finding details and assess the threat level",
        "instructions": [
          "Review the finding description: {{Description}}",
          "Check the affected resource: {{ResourceType}} ({{InstanceId}})",
          "Verify the timeline: First seen {{EventFirstSeen}}, Last seen {{EventLastSeen}}",
          "Review occurrence count: {{Count}} events"
        ]
      },
      {
        "title": "Threat Analysis", 
        "description": "Analyze the threat indicators and potential impact",
        "instructions": [
          "{{#if RemoteIpAddress}}Investigate remote IP: {{RemoteIpAddress}} ({{RemoteIpCountry}}){{/if}}",
          "{{#if DnsRequestDomain}}Analyze DNS requests to: {{DnsRequestDomain}}{{/if}}",
          "{{#if ThreatNames}}Review threat intelligence: {{ThreatNames}}{{/if}}",
          "Check for lateral movement indicators",
          "Assess potential data exposure"
        ]
      },
      {
        "title": "Containment Actions",
        "description": "Implement immediate containment measures",
        "instructions": [
          "{{#if (contains Type 'Malware')}}Isolate affected instance immediately{{/if}}",
          "{{#if (contains Type 'CryptoCurrency')}}Block cryptocurrency mining traffic{{/if}}",
          "{{#if (contains Type 'Exfiltration')}}Review and restrict data access permissions{{/if}}",
          "{{#if RemoteIpAddress}}Consider blocking malicious IP: {{RemoteIpAddress}}{{/if}}",
          "Review and update security group rules"
        ]
      },
      {
        "title": "Investigation",
        "description": "Conduct detailed forensic investigation",
        "instructions": [
          "Review CloudTrail logs for the affected timeframe",
          "Analyze VPC Flow Logs for network activity",
          "Check AWS Config for configuration changes",
          "Review IAM access patterns and permissions",
          "Collect memory dumps if malware is suspected"
        ]
      },
      {
        "title": "Remediation",
        "description": "Implement remediation measures",
        "instructions": [
          "Patch and update affected systems",
          "Rotate compromised credentials",
          "Update security policies and procedures",
          "Implement additional monitoring controls",
          "Document lessons learned"
        ]
      }
    ],
    "customDetails": {
      "GuardDutyFindingId": "{{FindingId}}",
      "AWSAccount": "{{AccountId}}",
      "AWSRegion": "{{Region}}",
      "FindingType": "{{Type}}",
      "SeverityScore": "{{Severity}}",
      "ResourceType": "{{ResourceType}}",
      "InstanceId": "{{InstanceId}}",
      "RemoteIP": "{{RemoteIpAddress}}",
      "RemoteCountry": "{{RemoteIpCountry}}",
      "DNSDomain": "{{DnsRequestDomain}}",
      "ThreatNames": "{{ThreatNames}}",
      "EventCount": "{{Count}}",
      "FirstSeen": "{{EventFirstSeen}}",
      "LastSeen": "{{EventLastSeen}}",
      "RawFinding": "{{RawJson}}"
    }
  }
}